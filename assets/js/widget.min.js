!function(){var e={338:function(e,t,r){"use strict";var s=r(795);t.H=s.createRoot,s.hydrateRoot},556:function(e,t,r){e.exports=r(694)()},694:function(e,t,r){"use strict";var s=r(925);function i(){}function n(){}n.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,n,a){if(a!==s){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:i};return r.PropTypes=r,r}},795:function(e){"use strict";e.exports=window.ReactDOM},925:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};!function(){"use strict";r.r(s),r.d(s,{default:function(){return xe}});var e=window.React,t=r.n(e),i=r(338),n=r(556),a=r.n(n),o=window.ReactJSXRuntime,c=$RefreshSig$();const l=["type","onClick","children","disabled","loading","variant","size","icon","ariaLabel","tooltip","data"];function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){h(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function h(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const p=t=>{c();let{type:r,onClick:s,children:i,disabled:n=!1,loading:a=!1,variant:u="primary",size:h="normal",icon:p=null,ariaLabel:m,tooltip:g,data:b={}}=t,y=function(e,t){if(null==e)return{};var r,s,i=function(e,t){if(null==e)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(-1!==t.indexOf(s))continue;r[s]=e[s]}return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(s=0;s<n.length;s++)r=n[s],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(t,l);const[f,v]=(0,e.useState)(!1),w=(0,e.useCallback)(async e=>{if(e.preventDefault(),!n&&!a){v(!0);try{s&&await s(r,b)}catch(t){}finally{setTimeout(()=>v(!1),150)}}},[s,r,b,n,a]),S=(0,e.useCallback)(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),w(e))},[w]);return(0,o.jsxs)("button",d(d({type:"button",className:(()=>{const e=["quick-action"];return e.push(`quick-action-${u}`),"normal"!==h&&e.push(`quick-action-${h}`),n&&e.push("quick-action-disabled"),a&&e.push("quick-action-loading"),f&&e.push("quick-action-pressed"),e.push(`quick-action-${r.replace(/_/g,"-")}`),e.join(" ")})(),onClick:w,onKeyDown:S,disabled:n||a,"aria-label":(()=>{if(m)return m;return{add_to_cart:a?"Adding item to cart":"Add item to cart",view_product:a?"Opening product details":"View product details",apply_coupon:a?"Applying coupon code":"Apply coupon code",compare:"Compare this product",wishlist:"Add to wishlist",share:"Share this product"}[r]||("string"==typeof i?i:"Action button")})(),title:g,"data-action-type":r,"data-testid":`quick-action-${r}`},y),{},{children:[(0,o.jsxs)("span",{className:"quick-action-content",children:[(p||r)&&(0,o.jsx)("span",{className:"quick-action-icon",children:a?(0,o.jsxs)("svg",{width:"small"===h?"14":"16",height:"small"===h?"14":"16",viewBox:"0 0 24 24",fill:"none",className:"loading-spinner","aria-hidden":"true",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",opacity:"0.25"}),(0,o.jsx)("path",{d:"m15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0",fill:"currentColor",opacity:"0.75"})]}):(()=>{const e={width:"small"===h?"14":"16",height:"small"===h?"14":"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true"};switch(p||r){case"add_to_cart":case"cart":return(0,o.jsxs)("svg",d(d({},e),{},{children:[(0,o.jsx)("circle",{cx:"9",cy:"21",r:"1"}),(0,o.jsx)("circle",{cx:"20",cy:"21",r:"1"}),(0,o.jsx)("path",{d:"m1 1 4 4 2 1 4 13 9 0"}),(0,o.jsx)("path",{d:"m6 8 15 0"})]}));case"view_product":case"view":case"eye":return(0,o.jsxs)("svg",d(d({},e),{},{children:[(0,o.jsx)("path",{d:"m1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8"}),(0,o.jsx)("circle",{cx:"12",cy:"12",r:"3"})]}));case"apply_coupon":case"coupon":case"tag":return(0,o.jsxs)("svg",d(d({},e),{},{children:[(0,o.jsx)("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),(0,o.jsx)("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})]}));case"compare":return(0,o.jsxs)("svg",d(d({},e),{},{children:[(0,o.jsx)("polyline",{points:"5 9 2 12 5 15"}),(0,o.jsx)("polyline",{points:"9 5 12 2 15 5"}),(0,o.jsx)("polyline",{points:"15 19 12 22 9 19"}),(0,o.jsx)("polyline",{points:"19 9 22 12 19 15"}),(0,o.jsx)("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),(0,o.jsx)("line",{x1:"12",y1:"2",y2:"22"})]}));case"wishlist":case"heart":return(0,o.jsx)("svg",d(d({},e),{},{children:(0,o.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}));case"share":return(0,o.jsxs)("svg",d(d({},e),{},{children:[(0,o.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,o.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,o.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,o.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,o.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}));case"loading":return(0,o.jsxs)("svg",d(d({},e),{},{className:"spinner",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),(0,o.jsx)("path",{d:"m15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0",opacity:"0.75"})]}));default:return null}})()}),i&&(0,o.jsx)("span",{className:"quick-action-text",children:i})]}),(0,o.jsx)("span",{className:"quick-action-focus-ring","aria-hidden":"true"}),(0,o.jsx)("span",{className:"quick-action-ripple","aria-hidden":"true"})]}))};c(p,"SFPCnko8wLUqw+8h1acm+/xuwCc="),m=p,p.propTypes={type:a().string.isRequired,onClick:a().func.isRequired,children:a().node,disabled:a().bool,loading:a().bool,variant:a().oneOf(["primary","secondary","tertiary","success","warning","danger","ghost","link"]),size:a().oneOf(["small","normal","large"]),icon:a().string,ariaLabel:a().string,tooltip:a().string,data:a().object},p.defaultProps={children:null,disabled:!1,loading:!1,variant:"primary",size:"normal",icon:null,ariaLabel:null,tooltip:null,data:{}};var m,g=p;$RefreshReg$(m,"QuickAction");var b=$RefreshSig$();function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function f(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const v=({product:t,conversationId:r,onAction:s,showActions:i=!0,enableComparison:n=!1,isCompact:a=!1,size:c="normal"})=>{b();const[l,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(null),[p,m]=(0,e.useState)(!1),[v,w]=(0,e.useState)(1),[S,x]=(0,e.useState)(null),[j,k]=(0,e.useState)(!1),[C,A]=(0,e.useState)(""),{id:O,name:E,price:N,regularPrice:T,image:R,description:I,permalink:P,inStock:L=!0,attributes:q=[],categories:M=[],variations:D=[]}=t,$=(0,e.useCallback)(async(e,t)=>{if(s&&r){u(!0),h(null);try{const i=await s(e,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach(function(t){f(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({productId:O,quantity:v,selectedVariation:S,conversationId:r},t));i&&i.success&&"add_to_cart"===e&&w(1)}catch(i){h(i.message||"Action failed. Please try again.")}finally{u(!1)}}},[s,r,O,v,S]),_=(0,e.useCallback)(()=>{$("add_to_cart",{quantity:v,variation:S})},[$,v,S]),U=(0,e.useCallback)(()=>{P&&window.open(P,"_blank","noopener,noreferrer"),$("view_product",{source:"chat_card"})},[$,P]),B=(0,e.useCallback)(async()=>{C.trim()?(await $("apply_coupon",{couponCode:C.trim()}),A(""),k(!1)):h("Please enter a coupon code")},[$,C]),z=(0,e.useCallback)(()=>{m(!p),$("toggle_comparison",{selected:!p})},[$,p]);return(0,o.jsxs)("article",{className:(()=>{const e=["product-card"];return"compact"===c||a?e.push("product-card-compact"):"detailed"===c&&e.push("product-card-detailed"),p&&n&&e.push("product-card-selected"),L||e.push("product-card-out-of-stock"),l&&e.push("product-card-loading"),e.join(" ")})(),"data-product-id":O,"data-testid":"product-card","aria-labelledby":`product-title-${O}`,role:"article",children:[n&&(0,o.jsxs)("div",{className:"comparison-checkbox",children:[(0,o.jsx)("input",{type:"checkbox",id:`compare-${O}`,checked:p,onChange:z,"aria-label":`Compare ${E}`}),(0,o.jsx)("label",{htmlFor:`compare-${O}`,className:"sr-only",children:"Compare this product"})]}),(0,o.jsxs)("div",{className:"product-card-image-container",onClick:U,children:[R?(0,o.jsx)("img",{src:R,alt:E,className:"product-card-image",loading:"lazy",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):(0,o.jsx)("div",{className:"product-card-image-placeholder","aria-hidden":"true",children:(0,o.jsxs)("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",children:[(0,o.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,o.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5",stroke:"currentColor",strokeWidth:"2"}),(0,o.jsx)("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor",strokeWidth:"2"})]})}),(0,o.jsx)("div",{className:"product-card-image-placeholder",style:{display:"none"},"aria-hidden":"true",children:(0,o.jsxs)("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",children:[(0,o.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,o.jsx)("circle",{cx:"8.5",cy:"8.5",r:"1.5",stroke:"currentColor",strokeWidth:"2"}),(0,o.jsx)("polyline",{points:"21,15 16,10 5,21",stroke:"currentColor",strokeWidth:"2"})]})})]}),(0,o.jsxs)("div",{className:"product-card-info",children:[(0,o.jsxs)("header",{className:"product-card-header",children:[(0,o.jsx)("h3",{id:`product-title-${O}`,className:"product-card-title",onClick:U,role:"button",tabIndex:"0",onKeyPress:e=>{"Enter"!==e.key&&" "!==e.key||U()},children:E}),(()=>{const e=T&&T!==N;return(0,o.jsxs)("div",{className:"product-card-price",children:[(0,o.jsx)("span",{className:"current-price","data-testid":"current-price",children:N}),e&&(0,o.jsx)("span",{className:"regular-price","data-testid":"regular-price",children:T})]})})()]}),I&&"compact"!==c&&(0,o.jsx)("p",{className:"product-card-description",children:I.length>100&&"detailed"!==c?`${I.substring(0,100)}...`:I}),"detailed"===c&&(q&&0!==q.length?(0,o.jsxs)("div",{className:"product-card-attributes",children:[q.slice(0,3).map((e,t)=>(0,o.jsxs)("span",{className:"attribute-tag",children:[e.name,": ",e.value]},t)),q.length>3&&(0,o.jsxs)("span",{className:"attribute-more",children:["+",q.length-3," more"]})]}):null),(0,o.jsxs)("div",{className:"product-card-meta",children:[(()=>{const e=L?"in-stock":"out-of-stock",t=L?"In Stock":"Out of Stock";return(0,o.jsxs)("span",{className:`stock-status ${e}`,"data-testid":"stock-status","aria-label":t,children:[(0,o.jsx)("span",{className:"stock-indicator","aria-hidden":"true"}),t]})})(),M.length>0&&"compact"!==c&&(0,o.jsx)("div",{className:"product-categories",children:M.slice(0,2).map((e,t)=>(0,o.jsx)("span",{className:"category-tag",children:e.name},t))})]}),d&&(0,o.jsx)("div",{className:"action-error",role:"alert","data-testid":"action-error",children:d}),j?(0,o.jsxs)("div",{className:"coupon-field","data-testid":"coupon-field",children:[(0,o.jsx)("input",{type:"text",value:C,onChange:e=>A(e.target.value),placeholder:"Enter coupon code",className:"coupon-input",disabled:l,onKeyPress:e=>{"Enter"===e.key&&B()},"aria-label":"Coupon code"}),(0,o.jsx)("button",{type:"button",onClick:B,disabled:l||!C.trim(),className:"apply-coupon-btn","aria-label":"Apply coupon",children:"Apply"})]}):null,i&&(0,o.jsxs)("div",{className:"product-card-actions",children:[(0,o.jsxs)("div",{className:"primary-actions",children:[(0,o.jsx)(g,{type:"add_to_cart",onClick:_,disabled:!L||l,loading:l,variant:"primary","data-testid":"add-to-cart-btn",children:l?"Adding...":"Add to Cart"}),(0,o.jsx)(g,{type:"view_product",onClick:U,disabled:l,variant:"secondary","data-testid":"view-product-btn",children:"View Details"})]}),(0,o.jsxs)("div",{className:"secondary-actions",children:[(0,o.jsx)(g,{type:"apply_coupon",onClick:()=>k(!j),disabled:l,variant:"tertiary",size:"small","data-testid":"coupon-toggle-btn",children:j?"Cancel":"Apply Coupon"}),"detailed"===c&&L&&(0,o.jsxs)("div",{className:"quantity-selector",children:[(0,o.jsx)("label",{htmlFor:`quantity-${O}`,className:"sr-only",children:"Quantity"}),(0,o.jsx)("select",{id:`quantity-${O}`,value:v,onChange:e=>w(parseInt(e.target.value)),disabled:l,className:"quantity-input",children:[...Array(10)].map((e,t)=>(0,o.jsx)("option",{value:t+1,children:t+1},t+1))})]})]})]})]}),l&&(0,o.jsx)("div",{className:"product-card-loading-overlay","aria-hidden":"true",children:(0,o.jsx)("div",{className:"loading-spinner"})})]})};b(v,"JF+OTLfiB8ZpNWPXsKJZhS3+b/Q="),w=v,v.propTypes={product:a().shape({id:a().oneOfType([a().string,a().number]).isRequired,name:a().string.isRequired,price:a().string.isRequired,regularPrice:a().string,image:a().string,description:a().string,permalink:a().string,inStock:a().bool,attributes:a().arrayOf(a().shape({name:a().string.isRequired,value:a().string.isRequired})),categories:a().arrayOf(a().shape({id:a().oneOfType([a().string,a().number]).isRequired,name:a().string.isRequired})),variations:a().array}).isRequired,conversationId:a().string,onAction:a().func.isRequired,showActions:a().bool,enableComparison:a().bool,isCompact:a().bool,size:a().oneOf(["compact","normal","detailed"])},v.defaultProps={conversationId:null,showActions:!0,enableComparison:!1,isCompact:!1,size:"normal"};var w,S=v;$RefreshReg$(w,"ProductCard");var x=$RefreshSig$();const j=({message:t,showTimestamp:r=!0,showAvatar:s=!0,conversationId:i,onProductAction:n,isStreaming:a=!1,streamingProgress:c=0,enableStreamingAnimation:l=!0})=>{x();const{id:u,content:d,type:h,timestamp:p,products:m,metadata:g}=t,[b,y]=(0,e.useState)(d),[f,v]=(0,e.useState)(!1),w=(0,e.useRef)(null),j=(0,e.useRef)(null);(0,e.useEffect)(()=>{a&&"bot"===h&&l?(v(!0),j.current=setInterval(()=>{v(e=>!e)},500),y(d)):(v(!1),j.current&&(clearInterval(j.current),j.current=null),y(d))},[d,a,h,l]),(0,e.useEffect)(()=>()=>{j.current&&clearInterval(j.current)},[]),(0,e.useEffect)(()=>{a&&w.current&&w.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})},[b,a]);const k=()=>{if(!m||!Array.isArray(m)||0===m.length)return null;const e=1===m.length?"products-grid-single":2===m.length?"products-grid-double":"products-grid-multiple";return(0,o.jsx)("div",{className:`message-products ${e}`,role:"region","aria-label":"Product recommendations",children:m.map((e,t)=>(0,o.jsx)(S,{product:e,conversationId:i,onAction:n,size:1===m.length?"detailed":m.length<=2?"normal":"compact",showActions:!!n},e.id||`product-${t}`))})};return(0,o.jsxs)("div",{className:`message ${"user"===h?"user-message":"bot-message"} ${a?"streaming":""}`,"data-message-id":u,role:"bot"===h?"log":void 0,"aria-label":"user"===h?"Your message":"Assistant message",ref:w,children:["bot"===h&&s&&(0,o.jsxs)("div",{className:"message-avatar "+(a?"streaming":""),"aria-hidden":"true",children:[(0,o.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"currentColor"}),(0,o.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),(0,o.jsx)("path",{d:"M9 9h.01M15 9h.01",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]}),a&&(0,o.jsxs)("div",{className:"streaming-indicator",title:"Assistant is typing...",children:[(0,o.jsx)("div",{className:"streaming-dot"}),(0,o.jsx)("div",{className:"streaming-dot"}),(0,o.jsx)("div",{className:"streaming-dot"})]})]}),(0,o.jsxs)("div",{className:"message-content",children:[a&&"bot"===h?(0,o.jsxs)("div",{className:"streaming-status",role:"status","aria-live":"polite",children:[(0,o.jsx)("div",{className:"streaming-progress-bar",children:(0,o.jsx)("div",{className:"streaming-progress-fill",style:{width:`${Math.max(5,100*c)}%`}})}),(0,o.jsx)("span",{className:"streaming-status-text","aria-label":"Assistant is generating response",children:c>0?`${Math.round(100*c)}%`:"Thinking..."})]}):null,(()=>{const e=e=>(0,o.jsxs)(o.Fragment,{children:[e,a&&"bot"===h&&f&&l?(0,o.jsx)("span",{className:"typing-cursor","aria-hidden":"true",children:"|"}):null]});if(g&&g.contentType)switch(g.contentType){case"product_recommendation":return(0,o.jsxs)("div",{className:"message-rich-content",children:[(0,o.jsx)("div",{className:"message-text",children:e(b)}),k()]});case"comparison":return(0,o.jsxs)("div",{className:"message-rich-content",children:[(0,o.jsx)("div",{className:"message-text",children:e(b)}),k(),g.comparisonData&&(0,o.jsxs)("div",{className:"comparison-summary",children:[(0,o.jsx)("h4",{children:"Comparison Summary"}),(0,o.jsx)("ul",{children:g.comparisonData.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]})]});default:return(0,o.jsxs)("div",{className:"message-text",children:[e(b),k()]})}return(0,o.jsxs)("div",{className:"message-text",children:[e(b),k()]})})(),r&&p&&!a&&(0,o.jsx)("time",{className:"message-timestamp",dateTime:p,title:new Date(p).toLocaleString(),children:(()=>{if(!p)return"";try{return new Date(p).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){return""}})()}),a&&(null==g?void 0:g.streaming)&&(0,o.jsx)("div",{className:"streaming-metadata","aria-hidden":"true",children:g.fallback&&(0,o.jsx)("span",{className:"fallback-indicator",children:"Offline mode"})})]})]})};x(j,"XOmYVHlWoMW8ZS8U4/u9zQ5afYw="),k=j,j.propTypes={message:a().shape({id:a().oneOfType([a().string,a().number]).isRequired,content:a().string.isRequired,type:a().oneOf(["user","bot"]).isRequired,timestamp:a().string,products:a().arrayOf(a().shape({id:a().oneOfType([a().string,a().number]).isRequired,name:a().string.isRequired,price:a().string.isRequired,image:a().string,description:a().string})),metadata:a().shape({contentType:a().string,comparisonData:a().array})}).isRequired,showTimestamp:a().bool,showAvatar:a().bool,conversationId:a().string,onProductAction:a().func,isStreaming:a().bool,streamingProgress:a().number,enableStreamingAnimation:a().bool},j.defaultProps={showTimestamp:!0,showAvatar:!0,conversationId:null,onProductAction:null,isStreaming:!1,streamingProgress:0,enableStreamingAnimation:!0};var k,C=j;$RefreshReg$(k,"Message");const A=({showAvatar:e=!0,ariaLabel:t="AI assistant is typing",className:r=""})=>(0,o.jsxs)("div",{className:`message bot-message typing-indicator ${r}`,role:"status","aria-live":"polite","aria-label":t,children:[e&&(0,o.jsx)("div",{className:"message-avatar","aria-hidden":"true",children:(0,o.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"currentColor"}),(0,o.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),(0,o.jsx)("path",{d:"M9 9h.01M15 9h.01",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,o.jsxs)("div",{className:"message-content",children:[(0,o.jsxs)("div",{className:"typing-dots","aria-hidden":"true",children:[(0,o.jsx)("span",{className:"dot dot-1"}),(0,o.jsx)("span",{className:"dot dot-2"}),(0,o.jsx)("span",{className:"dot dot-3"})]}),(0,o.jsx)("span",{className:"sr-only",children:t})]})]});O=A,A.propTypes={showAvatar:a().bool,ariaLabel:a().string,className:a().string},A.defaultProps={showAvatar:!0,ariaLabel:"AI assistant is typing",className:""};var O,E=A;$RefreshReg$(O,"TypingIndicator");var N=$RefreshSig$();const T=({onSendMessage:t,isDisabled:r=!1,isTyping:s=!1,placeholder:i="Type your message...",maxLength:n=1e3,showCounterAt:a=800,autoFocus:c=!1,onFocus:l,onBlur:u})=>{N();const[d,h]=(0,e.useState)(""),[p,m]=(0,e.useState)(!1),g=(0,e.useRef)(null);(0,e.useEffect)(()=>{c&&g.current&&setTimeout(()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.focus()},100)},[c]);const b=(0,e.useCallback)(e=>{const t=e.target.value;t.length<=n&&h(t)},[n]),y=(0,e.useCallback)(e=>{e.preventDefault();const i=d.trim();!i||s||r||(t(i),h(""),setTimeout(()=>{var e;return null===(e=g.current)||void 0===e?void 0:e.focus()},50))},[d,s,r,t]),f=(0,e.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y(e))},[y]),v=(0,e.useCallback)(e=>{m(!0),l&&l(e)},[l]),w=(0,e.useCallback)(e=>{m(!1),u&&u(e)},[u]),S=d.trim()&&!s&&!r,x=d.length>=a,j=n-d.length;return(0,o.jsxs)("form",{className:"chat-input-form",onSubmit:y,role:"form","aria-label":"Message input form",children:[(0,o.jsxs)("div",{className:"input-container "+(p?"focused":""),children:[(0,o.jsx)("textarea",{ref:g,value:d,onChange:b,onKeyDown:f,onFocus:v,onBlur:w,placeholder:i,"aria-label":"Type your message","aria-describedby":x?"char-counter":void 0,className:"message-input",rows:"1",disabled:r,maxLength:n,style:{minHeight:"20px",maxHeight:"120px",resize:"none",overflow:"auto"}}),(0,o.jsxs)("button",{type:"submit",className:"send-button "+(S?"enabled":"disabled"),disabled:!S,"aria-label":"Send message"+(s?" (AI is typing)":""),title:s?"Please wait for AI response":d.trim()?"Send message (Enter)":"Enter a message to send",children:[(0,o.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,o.jsx)("span",{className:"sr-only",children:"Send"})]})]}),x&&(0,o.jsxs)("div",{id:"char-counter",className:"character-counter "+(j<50?"counter-critical":j<100?"counter-warning":"counter-normal"),role:"status","aria-live":"polite",children:[d.length,"/",n,j<50&&(0,o.jsxs)("span",{className:"sr-only",children:[j," characters remaining"]})]}),p&&!r&&(0,o.jsx)("div",{className:"input-helper",role:"status",children:(0,o.jsxs)("span",{className:"keyboard-hint",children:["Press ",(0,o.jsx)("kbd",{children:"Enter"})," to send, ",(0,o.jsx)("kbd",{children:"Shift+Enter"})," for new line"]})})]})};N(T,"aFnETf/uRYwqzTFVQN6ZAdvZHic="),R=T,T.propTypes={onSendMessage:a().func.isRequired,isDisabled:a().bool,isTyping:a().bool,placeholder:a().string,maxLength:a().number,showCounterAt:a().number,autoFocus:a().bool,onFocus:a().func,onBlur:a().func},T.defaultProps={isDisabled:!1,isTyping:!1,placeholder:"Type your message...",maxLength:1e3,showCounterAt:800,autoFocus:!1,onFocus:null,onBlur:null};var R,I=T;$RefreshReg$(R,"MessageInput");var P=$RefreshSig$();const L=({isVisible:t,onToggleVisibility:r,onClose:s,conversation:i,isTyping:n,connectionStatus:a,onSendMessage:c,onClearConversation:l,onReconnect:u,config:d,userContext:h,pageContext:p,error:m,onDismissError:g,streamingMessage:b,streamingProgress:y,isStreamingSupported:f})=>{var v,w,S,x;P();const[j,k]=(0,e.useState)(!1),[A,O]=(0,e.useState)(!0),[N,T]=(0,e.useState)(!0),R=(0,e.useRef)(null),L=(0,e.useRef)(null),q=(0,e.useCallback)(()=>{N&&R.current&&R.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[N]),M=(0,e.useCallback)(()=>{if(L.current){const{scrollTop:e,scrollHeight:t,clientHeight:r}=L.current;T(t-e-r<50)}},[]);(0,e.useEffect)(()=>{t&&q()},[t,i,q]);const D=(0,e.useCallback)(e=>{c(e),O(!1),T(!0),setTimeout(q,100)},[c,q]),$=(0,e.useCallback)(()=>{k(!0),setTimeout(()=>{r(),k(!1)},200)},[r]);(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&t&&$()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,$]);const _=(()=>{switch(a){case"connected":return{text:"Online",className:"status-connected"};case"connecting":return{text:"Connecting...",className:"status-connecting"};case"disconnected":return{text:"Disconnected",className:"status-disconnected"};case"error":return{text:"Connection Error",className:"status-error"};default:return{text:"Unknown",className:"status-unknown"}}})();return(0,o.jsxs)("div",{className:`chat-widget ${t?"visible":"minimized"} ${j?"minimizing":""}`,role:"dialog","aria-label":"AI Assistant Chat","aria-expanded":t,"data-connection-status":a,children:[!t&&(0,o.jsxs)("button",{className:"chat-toggle-button",onClick:r,"aria-label":"Open AI Assistant Chat",title:"Chat with AI Assistant",children:[(0,o.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V16C2 17.1 2.9 18 4 18H6L10 22L14 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"currentColor"})}),(0,o.jsx)("span",{className:"sr-only",children:"Open Chat"})]}),t&&(0,o.jsxs)("div",{className:"chat-window",children:[(0,o.jsxs)("div",{className:"chat-header",children:[(0,o.jsxs)("div",{className:"chat-title",children:[(0,o.jsx)("h3",{children:"AI Assistant"}),(0,o.jsxs)("div",{className:`connection-status ${_.className}`,children:[(0,o.jsx)("span",{className:"status-indicator","aria-hidden":"true"}),(0,o.jsx)("span",{className:"status-text",children:_.text})]})]}),(0,o.jsxs)("div",{className:"chat-controls",children:[(0,o.jsx)("button",{className:"control-button minimize-button",onClick:$,"aria-label":"Minimize chat",title:"Minimize",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M4 8H12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,o.jsx)("button",{className:"control-button close-button",onClick:s,"aria-label":"Close chat",title:"Close",children:(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:(0,o.jsx)("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]}),m&&(0,o.jsxs)("div",{className:"chat-error",role:"alert","aria-live":"polite",children:[(0,o.jsxs)("div",{className:"error-content",children:[(0,o.jsx)("span",{className:"error-message",children:m.message}),(0,o.jsx)("button",{className:"error-dismiss",onClick:g,"aria-label":"Dismiss error",children:"Ã—"})]}),"error"===a&&u&&(0,o.jsx)("button",{className:"retry-button",onClick:u,children:"Try Again"})]}),(0,o.jsxs)("div",{className:"chat-messages",ref:L,onScroll:M,role:"log","aria-live":"polite","aria-label":"Chat messages",children:[A&&0===i.length&&(0,o.jsx)(C,{message:{id:"welcome",content:(()=>{if(d.welcomeMessage)return d.welcomeMessage;switch(null==p?void 0:p.type){case"product":return"Hi! I can help you with questions about this product, shipping, or anything else.";case"shop":return"Hi! I'm here to help you find the perfect products. What are you looking for?";case"cart":return"Hi! Need help with your cart or have questions before checkout?";default:return"Hi! I'm your AI assistant. How can I help you today?"}})(),type:"bot",timestamp:(new Date).toISOString()},showTimestamp:!1,showAvatar:!0}),i.map((e,t)=>(0,o.jsx)(C,{message:e,showTimestamp:!1!==(null==d?void 0:d.showTimestamps),showAvatar:"bot"===e.type,isStreaming:e.id===b,streamingProgress:e.id===b?y:0,enableStreamingAnimation:!1!==(null==d?void 0:d.enableStreamingAnimation)},e.id||`msg-${t}`)),n&&(0,o.jsx)(E,{showAvatar:!0,ariaLabel:(null==d||null===(v=d.strings)||void 0===v?void 0:v.typing)||"AI assistant is typing"}),(0,o.jsx)("div",{ref:R,"aria-hidden":"true"})]}),(0,o.jsx)(I,{onSendMessage:D,isDisabled:"error"===a||"disconnected"===a,isTyping:n,placeholder:(null==d||null===(w=d.strings)||void 0===w?void 0:w.inputPlaceholder)||"Type your message...",maxLength:(null==d||null===(S=d.limits)||void 0===S?void 0:S.maxMessageLength)||1e3,showCounterAt:(null==d||null===(x=d.limits)||void 0===x?void 0:x.showCounterAt)||800,autoFocus:t}),i.length>0&&(0,o.jsx)("div",{className:"chat-footer",children:(0,o.jsx)("button",{className:"clear-chat-button",onClick:l,title:"Clear conversation",children:"Clear Chat"})})]})]})};P(L,"FFLhLFQzHCsRq9FCJuNRGqJ2J1E="),q=L,L.propTypes={isVisible:a().bool.isRequired,onToggleVisibility:a().func.isRequired,onClose:a().func.isRequired,conversation:a().arrayOf(a().shape({id:a().oneOfType([a().string,a().number]),type:a().oneOf(["user","bot"]).isRequired,content:a().string.isRequired,timestamp:a().string})),isTyping:a().bool,connectionStatus:a().oneOf(["connected","connecting","disconnected","error"]),onSendMessage:a().func.isRequired,onClearConversation:a().func.isRequired,onReconnect:a().func,config:a().shape({welcomeMessage:a().string,language:a().string,theme:a().oneOf(["light","dark","auto"]),position:a().oneOf(["bottom-left","bottom-right","top-left","top-right"]),showTimestamps:a().bool,strings:a().shape({inputPlaceholder:a().string,typing:a().string,clearChat:a().string,minimize:a().string,close:a().string}),limits:a().shape({maxMessageLength:a().number,showCounterAt:a().number,maxConversationLength:a().number})}).isRequired,userContext:a().shape({id:a().number,email:a().string}).isRequired,pageContext:a().shape({type:a().string,id:a().number,url:a().string}).isRequired,error:a().shape({message:a().string.isRequired,critical:a().bool}),onDismissError:a().func.isRequired,streamingMessage:a().string,streamingProgress:a().number,isStreamingSupported:a().bool},L.defaultProps={conversation:[],isTyping:!1,connectionStatus:"connecting",error:null,onReconnect:null,streamingMessage:null,streamingProgress:0,isStreamingSupported:!1};var q,M=L;$RefreshReg$(q,"ChatWindow");class D extends t().Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError({error:e,errorInfo:t,timestamp:(new Date).toISOString()})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,o.jsx)("div",{className:"error-boundary-fallback",role:"alert","aria-live":"polite",children:(0,o.jsxs)("div",{className:"error-content",children:[(0,o.jsx)("h4",{children:"Something went wrong"}),(0,o.jsx)("p",{children:"The chat widget encountered an error. Please refresh the page to try again."}),(0,o.jsxs)("div",{className:"error-actions",children:[(0,o.jsx)("button",{className:"retry-button",onClick:()=>window.location.reload(),type:"button",children:"Refresh Page"}),this.props.onRetry&&(0,o.jsx)("button",{className:"retry-button",onClick:()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onRetry()},type:"button",children:"Try Again"})]}),!1]})}):this.props.children}}D.propTypes={children:a().node.isRequired,onError:a().func,onRetry:a().func,fallback:a().node},D.defaultProps={onError:null,onRetry:null,fallback:null};var $=D;function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach(function(t){B(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function B(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const z={stream:"/stream",fallback:"/chat"},W={maxRetries:5,initialDelay:1e3,maxDelay:3e4,backoffFactor:2},F={connection:1e4,response:6e4,keepAlive:3e4},V={maxSize:1e3,debounceMs:50},H="disconnected",K="connecting",Q="connected",J="reconnecting",G="error";class X{constructor({baseUrl:e,namespace:t,nonce:r,onStateChange:s,onError:i,logger:n}){this.baseUrl=this.normalizeBaseUrl(e),this.namespace=t||"woo-ai-assistant/v1",this.nonce=r,this.onStateChange=s||(()=>{}),this.onError=i||(()=>{}),this.logger=n||console,this.state=H,this.eventSource=null,this.reconnectAttempt=0,this.reconnectTimer=null,this.activeStreams=new Map,this.messageBuffer=new Map,this.debounceTimers=new Map,this.supportsSSE="undefined"!=typeof EventSource,this.supportsStreaming=this.detectStreamingSupport(),this.debugLog("StreamingService initialized",{baseUrl:this.baseUrl,namespace:this.namespace,supportsSSE:this.supportsSSE,supportsStreaming:this.supportsStreaming})}normalizeBaseUrl(e){return e?e.replace(/\/$/,""):window.location.origin}detectStreamingSupport(){if(!this.supportsSSE)return!1;if("undefined"==typeof ReadableStream)return!1;try{return new EventSource("data:text/event-stream,").close(),!0}catch(e){return this.debugLog("EventSource test failed",e),!1}}buildStreamingUrl(e){return`${`${this.baseUrl}/wp-json`}/${`${this.namespace}${e}`}`}changeState(e,t={}){const r=this.state;this.state=e,this.debugLog("State changed",{from:r,to:e,metadata:t}),this.onStateChange(U({state:e,previousState:r,timestamp:(new Date).toISOString()},t))}async startStream(e,t,r,s,i){if(!this.supportsStreaming)throw new Error("Streaming not supported in this browser");const n=`stream_${Date.now()}_${Math.random().toString(36).substring(7)}`;this.debugLog("Starting stream session",{sessionId:n,conversationId:t,message:e.substring(0,100)+"..."}),this.activeStreams.set(n,{conversationId:t,onChunk:s,onComplete:i,startTime:Date.now(),totalChunks:0,totalBytes:0}),this.messageBuffer.set(n,{content:"",metadata:null});try{return await this.initializeConnection(n,e,t,r),n}catch(a){throw this.activeStreams.delete(n),this.messageBuffer.delete(n),a}}async initializeConnection(e,t,r,s){this.changeState(K);const i=this.buildStreamingUrl(z.stream),n=new URL(i);n.searchParams.append("session_id",e),n.searchParams.append("conversation_id",r),n.searchParams.append("message",encodeURIComponent(t)),n.searchParams.append("nonce",this.nonce),s&&n.searchParams.append("user_context",JSON.stringify(s));try{this.eventSource=new EventSource(n.toString());const t=setTimeout(()=>{this.handleConnectionTimeout()},F.connection);this.setupEventSourceListeners(e,t)}catch(a){throw this.changeState(G,{error:a.message}),new Error(`Failed to initialize streaming connection: ${a.message}`)}}setupEventSourceListeners(e,t){this.eventSource&&(this.eventSource.onopen=()=>{clearTimeout(t),this.changeState(Q),this.reconnectAttempt=0,this.debugLog("SSE connection established",{sessionId:e})},this.eventSource.onmessage=t=>{this.handleStreamMessage(e,t)},this.eventSource.onerror=r=>{clearTimeout(t),this.handleStreamError(e,r)},this.eventSource.addEventListener("chunk",t=>{this.handleChunkEvent(e,t)}),this.eventSource.addEventListener("metadata",t=>{this.handleMetadataEvent(e,t)}),this.eventSource.addEventListener("complete",t=>{this.handleCompleteEvent(e,t)}),this.eventSource.addEventListener("error",t=>{this.handleErrorEvent(e,t)}))}handleStreamMessage(e,t){try{const r=JSON.parse(t.data);switch(r.type){case"chunk":this.processChunk(e,r);break;case"metadata":this.processMetadata(e,r);break;case"complete":this.processComplete(e,r);break;case"error":this.processError(e,r);break;default:this.debugLog("Unknown message type received",r)}}catch(r){this.debugLog("Error parsing SSE message",r)}}handleChunkEvent(e,t){try{const r=JSON.parse(t.data);this.processChunk(e,r)}catch(r){this.debugLog("Error processing chunk event",r)}}handleMetadataEvent(e,t){try{const r=JSON.parse(t.data);this.processMetadata(e,r)}catch(r){this.debugLog("Error processing metadata event",r)}}handleCompleteEvent(e,t){try{const r=JSON.parse(t.data);this.processComplete(e,r)}catch(r){this.debugLog("Error processing complete event",r)}}handleErrorEvent(e,t){try{const r=JSON.parse(t.data);this.processError(e,r)}catch(r){this.debugLog("Error processing error event",r)}}processChunk(e,t){const r=this.activeStreams.get(e),s=this.messageBuffer.get(e);if(!r||!s)return void this.debugLog("Session not found for chunk",{sessionId:e});const{chunk:i,index:n,isComplete:a}=t;s.content+=i,r.totalChunks+=1,r.totalBytes+=i.length,this.debounceTimers.has(e)&&clearTimeout(this.debounceTimers.get(e));const o=setTimeout(()=>{this.deliverChunk(e,{chunk:i,content:s.content,index:n,isComplete:a,progress:this.calculateProgress(r,t),metadata:s.metadata}),this.debounceTimers.delete(e)},V.debounceMs);this.debounceTimers.set(e,o)}processMetadata(e,t){const r=this.messageBuffer.get(e);r&&(r.metadata=t,this.debugLog("Metadata received",{sessionId:e,metadata:t}))}processComplete(e,t){const r=this.activeStreams.get(e),s=this.messageBuffer.get(e);if(!r||!s)return void this.debugLog("Session not found for completion",{sessionId:e});this.debounceTimers.has(e)&&(clearTimeout(this.debounceTimers.get(e)),this.debounceTimers.delete(e));const i=U({content:s.content,metadata:s.metadata||{},statistics:{totalChunks:r.totalChunks,totalBytes:r.totalBytes,duration:Date.now()-r.startTime}},t);this.debugLog("Stream completed",{sessionId:e,statistics:i.statistics}),r.onComplete(i),this.cleanup(e)}processError(e,t){if(this.activeStreams.get(e)){const r=new Error(t.message||"Streaming error occurred");r.type=t.type||"stream_error",r.code=t.code,r.details=t.details,this.onError({message:r.message,type:r.type,critical:!1,sessionId:e,details:r.details}),this.attemptRecovery(e,r)}}deliverChunk(e,t){const r=this.activeStreams.get(e);if(r&&r.onChunk)try{r.onChunk(t)}catch(s){this.debugLog("Error in chunk callback",s)}}calculateProgress(e,t){if(t.totalChunks&&void 0!==t.index)return Math.min(1,(t.index+1)/t.totalChunks);const r=Date.now()-e.startTime;return Math.min(.9,r/1e4)}handleConnectionTimeout(){this.debugLog("SSE connection timeout"),this.changeState(G,{error:"Connection timeout"}),this.eventSource&&(this.eventSource.close(),this.eventSource=null)}handleStreamError(e,t){this.debugLog("SSE connection error",t),this.reconnectAttempt<W.maxRetries?this.attemptReconnection(e):(this.changeState(G,{error:"Max reconnection attempts exceeded"}),this.cleanup(e))}attemptReconnection(e){this.reconnectAttempt+=1,this.changeState(J,{attempt:this.reconnectAttempt,maxRetries:W.maxRetries});const t=Math.min(W.initialDelay*Math.pow(W.backoffFactor,this.reconnectAttempt-1),W.maxDelay);this.debugLog("Attempting reconnection",{attempt:this.reconnectAttempt,delay:t,sessionId:e}),this.reconnectTimer=setTimeout(()=>{this.retryConnection(e)},t)}async retryConnection(e){if(this.activeStreams.get(e))try{throw this.eventSource&&(this.eventSource.close(),this.eventSource=null),new Error("Reconnection logic not fully implemented")}catch(t){this.debugLog("Reconnection failed",t),this.reconnectAttempt<W.maxRetries?this.attemptReconnection(e):(this.changeState(G),this.cleanup(e))}else this.debugLog("Session not found for retry",{sessionId:e})}attemptRecovery(e,t){this.debugLog("Attempting error recovery",{sessionId:e,error:t.message}),this.cleanup(e)}stopStream(e){this.debugLog("Stopping stream session",{sessionId:e}),this.debounceTimers.has(e)&&(clearTimeout(this.debounceTimers.get(e)),this.debounceTimers.delete(e)),this.cleanup(e)}cleanup(e){this.activeStreams.delete(e),this.messageBuffer.delete(e),this.debounceTimers.has(e)&&(clearTimeout(this.debounceTimers.get(e)),this.debounceTimers.delete(e)),0===this.activeStreams.size&&this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.changeState(H))}disconnect(){this.debugLog("Disconnecting all streams"),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null);for(const e of this.activeStreams.keys())this.cleanup(e);this.eventSource&&(this.eventSource.close(),this.eventSource=null),this.changeState(H),this.reconnectAttempt=0}getState(){return this.state}isStreamingAvailable(){return this.supportsStreaming&&this.state!==G}getActiveStreamCount(){return this.activeStreams.size}debugLog(e,t={}){var r;!0===(null===(r=window.wooAiAssistant)||void 0===r?void 0:r.debug)&&this.logger.log(`[WooAI-Streaming] ${e}`,t)}}var Y=$RefreshSig$(),Z=$RefreshSig$();function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach(function(t){re(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function re(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const se={namespace:"woo-ai-assistant/v1",endpoints:{chat:"/chat",action:"/action",rating:"/rating",config:"/config"},retryConfig:{maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2},timeouts:{default:3e4,streaming:6e4,config:1e4},rateLimits:{requests:60,windowMs:6e4}},ie={NETWORK:"network_error",TIMEOUT:"timeout_error",RATE_LIMIT:"rate_limit_error",AUTHENTICATION:"auth_error",VALIDATION:"validation_error",SERVER:"server_error",STREAMING:"streaming_error",UNKNOWN:"unknown_error"},ne=(0,e.createContext)(null),ae=()=>{Y();const t=(0,e.useContext)(ne);if(!t)throw new Error("useApi must be used within an ApiProvider");return t};Y(ae,"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=");class oe{constructor({baseUrl:e,nonce:t,userId:r,pageContext:s,onError:i}){this.baseUrl=this.normalizeBaseUrl(e),this.nonce=t,this.userId=r,this.pageContext=s||{},this.onError=i||(()=>{}),this.requestQueue=[],this.activeRequests=new Set,this.retryAttempts=new Map,this.circuitBreakerState={isOpen:!1,failures:0,lastFailureTime:null,threshold:5,timeout:3e4},this.streamingService=new X({baseUrl:this.baseUrl,namespace:se.namespace,nonce:this.nonce,onStateChange:this.handleStreamStateChange.bind(this),onError:this.onError,logger:this}),this.debugLog("ApiService initialized",{baseUrl:this.baseUrl,userId:this.userId,pageContext:this.pageContext,streamingSupported:this.streamingService.isStreamingAvailable()})}normalizeBaseUrl(e){return e?e.replace(/\/$/,""):window.location.origin}buildApiUrl(e){return`${`${this.baseUrl}/wp-json`}/${`${se.namespace}${e}`}`}createHeaders(e={}){return te({"Content-Type":"application/json","X-WP-Nonce":this.nonce,"X-Requested-With":"XMLHttpRequest"},e)}isCircuitBreakerOpen(){const{isOpen:e,lastFailureTime:t,timeout:r}=this.circuitBreakerState;return!!e&&(!(Date.now()-t>r)||(this.circuitBreakerState.isOpen=!1,this.circuitBreakerState.failures=0,this.debugLog("Circuit breaker closed after timeout"),!1))}recordCircuitBreakerFailure(){this.circuitBreakerState.failures+=1,this.circuitBreakerState.lastFailureTime=Date.now(),this.circuitBreakerState.failures>=this.circuitBreakerState.threshold&&(this.circuitBreakerState.isOpen=!0,this.debugLog("Circuit breaker opened due to failures",{failures:this.circuitBreakerState.failures}))}resetCircuitBreaker(){this.circuitBreakerState.failures>0&&(this.circuitBreakerState.failures=0,this.circuitBreakerState.isOpen=!1,this.debugLog("Circuit breaker reset after successful request"))}checkRateLimit(){const e=Date.now(),{requests:t,windowMs:r}=se.rateLimits;return this.requestQueue=this.requestQueue.filter(t=>e-t<r),this.requestQueue.length>=t?(this.debugLog("Rate limit exceeded",{requests:this.requestQueue.length,limit:t}),!1):(this.requestQueue.push(e),!0)}calculateRetryDelay(e){const{baseDelay:t,maxDelay:r,backoffFactor:s}=se.retryConfig;return Math.min(t*Math.pow(s,e),r)+1e3*Math.random()}delay(e){return new Promise(t=>setTimeout(t,e))}async makeRequest(e,t={}){const{method:r="GET",body:s=null,headers:i={},timeout:n=se.timeouts.default,skipRetry:a=!1}=t,o=`${r}-${e}-${Date.now()}`;if(this.debugLog("Making API request",{requestId:o,endpoint:e,method:r,timeout:n}),this.isCircuitBreakerOpen()){throw this.createApiError(ie.SERVER,"Service temporarily unavailable",503,{circuitBreakerOpen:!0})}if(!this.checkRateLimit()){throw this.createApiError(ie.RATE_LIMIT,"Too many requests. Please try again later.",429)}const c=this.buildApiUrl(e),l=this.createHeaders(i),u=new AbortController,d=setTimeout(()=>{u.abort()},n),h={method:r,headers:l,signal:u.signal};!s||"POST"!==r&&"PUT"!==r&&"PATCH"!==r||(h.body=JSON.stringify(s)),this.activeRequests.add(o);try{const e=await fetch(c,h);clearTimeout(d),e.ok||await this.handleErrorResponse(e);const t=await e.json();return this.resetCircuitBreaker(),this.debugLog("API request successful",{requestId:o,status:e.status}),t}catch(p){let s;if(clearTimeout(d),this.recordCircuitBreakerFailure(),s="AbortError"===p.name?this.createApiError(ie.TIMEOUT,"Request timed out. Please try again.",408,{timeout:n}):p instanceof TypeError&&p.message.includes("fetch")?this.createApiError(ie.NETWORK,"Network error. Please check your connection.",0,{originalError:p.message}):p.isApiError?p:this.createApiError(ie.UNKNOWN,"An unexpected error occurred.",0,{originalError:p.message}),this.debugLog("API request failed",{requestId:o,error:s}),!a){const i=`${r}-${e}`,n=this.retryAttempts.get(i)||0;if(n<se.retryConfig.maxRetries&&this.shouldRetry(s)){this.retryAttempts.set(i,n+1);const r=this.calculateRetryDelay(n);return this.debugLog("Retrying request",{requestId:o,attempt:n+1,delay:r}),await this.delay(r),this.makeRequest(e,te(te({},t),{},{skipRetry:!1}))}this.retryAttempts.delete(i)}throw s}finally{this.activeRequests.delete(o)}}async handleErrorResponse(e){let t,r;try{t=await e.json()}catch(s){t={message:`HTTP ${e.status}: ${e.statusText}`,code:"http_error"}}switch(e.status){case 400:r=ie.VALIDATION;break;case 401:case 403:r=ie.AUTHENTICATION;break;case 429:r=ie.RATE_LIMIT;break;case 500:case 502:case 503:case 504:r=ie.SERVER;break;default:r=ie.UNKNOWN}throw this.createApiError(r,t.message||"Request failed",e.status,t)}shouldRetry(e){return e.type!==ie.AUTHENTICATION&&e.type!==ie.VALIDATION&&(e.type!==ie.RATE_LIMIT&&[ie.NETWORK,ie.TIMEOUT,ie.SERVER,ie.UNKNOWN].includes(e.type))}createApiError(e,t,r=0,s={}){const i=new Error(t);return i.isApiError=!0,i.type=e,i.status=r,i.details=s,i.timestamp=(new Date).toISOString(),i}handleStreamStateChange(e){this.debugLog("Streaming state changed",e),"error"===e.state&&this.onError({message:"Streaming service error",type:ie.STREAMING,critical:!1,details:e})}async sendMessage(e,t=null,r={}){if(!e||"string"!=typeof e||!e.trim())throw this.createApiError(ie.VALIDATION,"Message is required and must be a non-empty string");const s={message:e.trim(),conversation_id:t,user_context:te(te(te({},this.pageContext),r),{},{timestamp:(new Date).toISOString()}),nonce:this.nonce};try{const e=await this.makeRequest(se.endpoints.chat,{method:"POST",body:s,timeout:se.timeouts.default});if(!e.success||!e.data)throw this.createApiError(ie.SERVER,"Invalid response format from server");return{conversationId:e.data.conversation_id,response:e.data.response,timestamp:e.data.timestamp,confidence:e.data.confidence||0,sources:e.data.sources||[],metadata:e.data.metadata||{}}}catch(i){throw this.onError({message:i.message,type:i.type||ie.UNKNOWN,critical:i.type===ie.AUTHENTICATION,details:i.details}),i}}async sendStreamingMessage(e,t=null,r=null,s={}){if(!e||"string"!=typeof e||!e.trim())throw this.createApiError(ie.VALIDATION,"Message is required and must be a non-empty string");if(!this.streamingService.isStreamingAvailable())return this.debugLog("Streaming not available, falling back to regular message"),this.sendStreamingMessageFallback(e,t,r,s);const i=te(te(te({},this.pageContext),s),{},{timestamp:(new Date).toISOString()});return this.debugLog("Starting streaming message",{conversationId:t,messageLength:e.length,streamingState:this.streamingService.getState()}),new Promise((n,a)=>{let o="",c=null,l=null;this.streamingService.startStream(e.trim(),t,i,e=>{const{chunk:t,content:s,isComplete:i,progress:n,metadata:a}=e;if(o=s,a&&(c=a),r)try{r({chunk:t,content:s,isComplete:i,progress:n,metadata:a})}catch(l){this.debugLog("Error in user chunk callback",l)}},e=>{const{content:r,metadata:s,statistics:i}=e;this.debugLog("Streaming completed",{sessionId:l,contentLength:(null==r?void 0:r.length)||0,statistics:i}),n({conversationId:t||(null==s?void 0:s.conversationId),response:r,timestamp:(new Date).toISOString(),confidence:(null==s?void 0:s.confidence)||0,sources:(null==s?void 0:s.sources)||[],metadata:te({streaming:!0,statistics:i},s)})}).then(e=>{l=e,this.debugLog("Streaming session started",{sessionId:l})}).catch(i=>{this.debugLog("Failed to start streaming session",i),this.sendStreamingMessageFallback(e,t,r,s).then(n).catch(a)})})}async sendStreamingMessageFallback(e,t,r,s){this.debugLog("Using streaming fallback (simulated chunks)");const i=await this.sendMessage(e,t,s);if(r&&i.response){const e=i.response.split(" "),t=Math.max(1,Math.floor(e.length/10));let s="";for(let i=0;i<e.length;i+=t){const n=e.slice(i,i+t).join(" ");s+=(i>0?" ":"")+n;const a=i+t>=e.length;r({chunk:n,content:s,isComplete:a,progress:Math.min(1,(i+t)/e.length),metadata:{fallback:!0}}),a||await this.delay(150)}}return i.metadata=te(te({},i.metadata),{},{streaming:!1,fallback:!0}),i}async executeAction(e,t,r){if(!e||!t||!r)throw this.createApiError(ie.VALIDATION,"Action type, data, and conversation ID are required");const s={action_type:e,action_data:t,conversation_id:r,nonce:this.nonce};try{const e=await this.makeRequest(se.endpoints.action,{method:"POST",body:s});return e.data||e}catch(i){throw this.onError({message:`Action failed: ${i.message}`,type:i.type||ie.UNKNOWN,critical:!1,details:te({actionType:e},i.details)}),i}}async submitRating(e,t,r=""){if(!e||!t||t<1||t>5)throw this.createApiError(ie.VALIDATION,"Valid conversation ID and rating (1-5) are required");const s={conversation_id:e,rating:Math.floor(t),feedback:r.trim(),nonce:this.nonce};try{const e=await this.makeRequest(se.endpoints.rating,{method:"POST",body:s});return e.data||e}catch(i){throw this.onError({message:`Rating submission failed: ${i.message}`,type:i.type||ie.UNKNOWN,critical:!1}),i}}async getConfig(e={}){try{const t=new URLSearchParams;Object.keys(e).length>0&&t.set("page_context",JSON.stringify(e));const r=se.endpoints.config+(t.toString()?`?${t.toString()}`:""),s=await this.makeRequest(r,{method:"GET",timeout:se.timeouts.config});return s.data||s}catch(t){return this.debugLog("Failed to load config, using defaults",t),{theme:"light",language:"en",welcomeMessage:"Hi! How can I help you today?",features:{streaming:!1,actions:!0,ratings:!0}}}}async testConnection(){try{return await this.getConfig(),!0}catch(e){return this.debugLog("Connection test failed",e),!1}}cancelAllRequests(){this.debugLog("Cancelling all active requests and streams",{activeRequests:this.activeRequests.size,activeStreams:this.streamingService.getActiveStreamCount()}),this.activeRequests.clear(),this.requestQueue=[],this.retryAttempts.clear(),this.streamingService.disconnect()}isStreamingAvailable(){return this.streamingService.isStreamingAvailable()}getStreamingState(){return this.streamingService.getState()}getStreamingStats(){return{state:this.streamingService.getState(),activeStreams:this.streamingService.getActiveStreamCount(),supportsStreaming:this.streamingService.isStreamingAvailable()}}debugLog(e,t={}){var r;null===(r=window.wooAiAssistant)||void 0===r||r.debug}}const ce=({children:t,baseUrl:r,nonce:s,userId:i,pageContext:n,onError:a})=>{Z();const c=(0,e.useMemo)(()=>new oe({baseUrl:r,nonce:s,userId:i,pageContext:n,onError:a}),[r,s,i,n,a]);return(0,o.jsx)(ne.Provider,{value:c,children:t})};Z(ce,"6vt49p7o+R35/YjvJFhrSLrB75U="),le=ce,ce.propTypes={children:a().node.isRequired,baseUrl:a().string.isRequired,nonce:a().string.isRequired,userId:a().number.isRequired,pageContext:a().shape({type:a().string,id:a().number,url:a().string}),onError:a().func.isRequired},ce.defaultProps={pageContext:{}};var le;$RefreshReg$(le,"ApiProvider");var ue=$RefreshSig$();function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function he(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach(function(t){pe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function pe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const me=({apiEndpoint:t,nonce:r,userId:s,pageContext:i,onError:n})=>{ue();const[a,o]=(0,e.useState)([]),[c,l]=(0,e.useState)(!1),[u,d]=(0,e.useState)("connecting"),[h,p]=(0,e.useState)(null),[m,g]=(0,e.useState)(null),[b,y]=(0,e.useState)(0),[f,v]=(0,e.useState)(!1),w=ae();(0,e.useEffect)(()=>{w&&(async()=>{try{if(d("connecting"),!await w.testConnection())throw new Error("API connectivity test failed");d("connected"),p(`conv_${Date.now()}_${s}`),v(w.isStreamingAvailable())}catch(e){d("error"),n&&n({message:"Failed to connect to chat service",type:"connection_error",critical:!1})}})()},[w,s,n]);const S=(0,e.useCallback)(async e=>{if(!e.trim()||!h||!w)return;const t={id:`msg_${Date.now()}`,content:e.trim(),type:"user",timestamp:(new Date).toISOString()};o(e=>[...e,t]),l(!0);const r=`msg_${Date.now()+1}`,s={id:r,content:"",type:"bot",timestamp:(new Date).toISOString(),isStreaming:f};o(e=>[...e,s]),g(r),y(0);try{let t;f?t=await w.sendStreamingMessage(e,h,e=>{const{content:t,progress:s,isComplete:i,metadata:n}=e;o(e=>e.map(e=>e.id===r?he(he({},e),{},{content:t,metadata:n,isStreaming:!i}):e)),y(s||0),i&&(g(null),y(0))},i):(t=await w.sendMessage(e,h,i),o(e=>e.map(e=>e.id===r?he(he({},e),{},{content:t.response||"Sorry, I could not process your request.",metadata:t.metadata,isStreaming:!1}):e))),t.conversationId&&t.conversationId!==h&&p(t.conversationId);const s={id:`msg_${Date.now()+1}`,content:t.response,type:"bot",timestamp:t.timestamp||(new Date).toISOString(),confidence:t.confidence,sources:t.sources,metadata:t.metadata};o(e=>[...e,s]),l(!1)}catch(n){l(!1),g(null),y(0),m&&o(e=>e.map(e=>e.id===m?he(he({},e),{},{content:"Sorry, there was an error processing your request.",isStreaming:!1,metadata:{error:!0}}):e)),"auth_error"!==n.type&&"server_error"!==n.type||d("error")}},[h,w,i,f,m]),x=(0,e.useCallback)(async(e,t)=>{if(!h||!w)throw new Error("Chat not initialized");try{return await w.executeAction(e,t,h)}catch(r){throw r}},[h,w]),j=(0,e.useCallback)(async(e,t="")=>{if(!h||!w)throw new Error("Chat not initialized");try{return await w.submitRating(h,e,t)}catch(r){throw r}},[h,w]),k=(0,e.useCallback)(()=>{o([]),p(`conv_${Date.now()}_${s}`)},[s]),C=(0,e.useCallback)(async()=>{if(w){d("connecting");try{if(!await w.testConnection())throw new Error("Reconnection failed");d("connected")}catch(e){d("error"),n&&n({message:"Failed to reconnect",type:"reconnection_error",critical:!1})}}},[w,n]);return(0,e.useEffect)(()=>()=>{w&&w.cancelAllRequests()},[w]),{conversation:a,isTyping:c,connectionStatus:u,conversationId:h,sendMessage:S,executeAction:x,submitRating:j,clearConversation:k,reconnect:C,streamingMessage:m,streamingProgress:b,isStreamingSupported:f}};ue(me,"9s1fXbx5CkfHZ9vLCWLLdBghOSA=",!1,function(){return[ae]});var ge=$RefreshSig$();const be=({isVisible:t,onToggleVisibility:r,onEscape:s})=>{ge(),(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&t&&s&&(e.preventDefault(),s()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"c"===e.key.toLowerCase()&&r&&(e.preventDefault(),r()),"Enter"===e.key&&e.target.matches("[data-chat-action]")&&(e.preventDefault(),e.target.click())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,r,s]),(0,e.useEffect)(()=>{if(t){const e=document.querySelector('.woo-ai-assistant-app[data-visible="true"]');if(e){const t=e.querySelector('button, input, textarea, select, [tabindex]:not([tabindex="-1"])');t&&t.focus()}}},[t])};ge(be,"3ubReDTFssvu4DHeldAg55cW/CI=");var ye=$RefreshSig$();const fe=({widgetId:t,config:r})=>{ye();const[s,i]=(0,e.useState)(!r.minimized),[n,a]=(0,e.useState)(!1),[c,l]=(0,e.useState)(null),{conversation:u,isTyping:d,connectionStatus:h,sendMessage:p,clearConversation:m,reconnect:g}=me({apiEndpoint:r.apiEndpoint,nonce:r.nonce,userId:r.userId,pageContext:{type:r.pageType,id:r.pageId,url:r.pageUrl},onError:l});be({isVisible:s,onToggleVisibility:()=>i(!s),onEscape:()=>i(!1)});const b=(0,e.useCallback)(()=>{i(e=>!e),!s&&c&&l(null)},[s,c]),y=(0,e.useCallback)(()=>{i(!1)},[]);return(0,e.useEffect)(()=>{if(r.autoOpen&&!s){const e=setTimeout(()=>{i(!0)},2e3);return()=>clearTimeout(e)}},[r.autoOpen,s]),(0,e.useEffect)(()=>{a(!0);const e=document.getElementById(t);return e&&e.setAttribute("data-widget-loaded","true"),()=>{e&&e.removeAttribute("data-widget-loaded")}},[t]),(0,e.useEffect)(()=>{r.isDebug},[t,r,s,h]),c&&c.critical?(0,o.jsx)("div",{className:"woo-ai-widget-error",role:"alert","aria-live":"polite",children:(0,o.jsxs)("div",{className:"error-content",children:[(0,o.jsx)("h4",{children:"Chat Unavailable"}),(0,o.jsx)("p",{children:"The chat service is temporarily unavailable. Please try again later or contact support."}),r.isDebug&&(0,o.jsxs)("details",{children:[(0,o.jsx)("summary",{children:"Error Details"}),(0,o.jsx)("pre",{children:c.message})]})]})}):(0,o.jsx)($,{onError:e=>{r.isDebug&&l({message:e.error.message,stack:e.errorInfo.componentStack,critical:!1})},children:(0,o.jsx)(ce,{baseUrl:r.apiEndpoint,nonce:r.nonce,debug:r.isDebug,children:(0,o.jsx)("div",{className:`woo-ai-assistant-app ${r.theme}`,"data-widget-id":t,"data-position":r.position,"data-visible":s,"data-loaded":n,style:{"--widget-primary-color":r.primaryColor||"#007cba","--widget-secondary-color":r.secondaryColor||"#f0f0f1","--widget-text-color":r.textColor||"#1e1e1e","--widget-border-radius":r.borderRadius||"8px"},children:(0,o.jsx)(M,{isVisible:s,onToggleVisibility:b,onClose:y,conversation:u,isTyping:d,connectionStatus:h,onSendMessage:p,onClearConversation:m,onReconnect:g,config:{welcomeMessage:r.welcomeMessage,language:r.language,theme:r.theme,position:r.position,strings:window.wooAiAssistant.strings||{},limits:window.wooAiAssistant.limits||{}},userContext:{id:r.userId,email:r.userEmail},pageContext:{type:r.pageType,id:r.pageId,url:r.pageUrl},error:c,onDismissError:()=>l(null)})})})})};ye(fe,"/OhsGinlyG7kxVcokcsYvWU+EyM=",!1,function(){return[me,be]}),ve=fe,fe.propTypes={widgetId:a().string.isRequired,config:a().shape({position:a().oneOf(["bottom-left","bottom-right","top-left","top-right"]),autoOpen:a().bool,minimized:a().bool,userId:a().number,userEmail:a().string,pageType:a().string,pageId:a().number,pageUrl:a().string,welcomeMessage:a().string,theme:a().oneOf(["light","dark","auto"]),language:a().string,primaryColor:a().string,secondaryColor:a().string,textColor:a().string,borderRadius:a().string,apiEndpoint:a().string.isRequired,nonce:a().string.isRequired,isDebug:a().bool,pluginVersion:a().string}).isRequired},fe.defaultProps={config:{position:"bottom-right",autoOpen:!1,minimized:!0,theme:"light",language:"en",isDebug:!1}};var ve,we=fe;$RefreshReg$(ve,"App");const Se=()=>{if(void 0===window.wooAiAssistant)return;let e=Array.from(document.querySelectorAll("[data-woo-ai-widget]"));if(0===e.length){const t=document.createElement("div");t.id="woo-ai-assistant-widget",t.setAttribute("data-woo-ai-widget","true"),document.body.appendChild(t),e=[t]}e.forEach((e,r)=>{var s,n,a,c,l;const u=`woo-ai-widget-${r}`;e.id=u;const d={position:e.getAttribute("data-position")||"bottom-right",autoOpen:"true"===e.getAttribute("data-auto-open"),minimized:"false"!==e.getAttribute("data-minimized"),userId:(null===(s=window.wooAiAssistant.currentUser)||void 0===s?void 0:s.id)||0,userEmail:(null===(n=window.wooAiAssistant.currentUser)||void 0===n?void 0:n.email)||"",pageType:(null===(a=window.wooAiAssistant.currentPage)||void 0===a?void 0:a.type)||"unknown",pageId:(null===(c=window.wooAiAssistant.currentPage)||void 0===c?void 0:c.id)||0,pageUrl:(null===(l=window.wooAiAssistant.currentPage)||void 0===l?void 0:l.url)||window.location.href,welcomeMessage:e.getAttribute("data-welcome-message")||"",theme:e.getAttribute("data-theme")||"light",language:e.getAttribute("data-language")||"en",apiEndpoint:window.wooAiAssistant.apiUrl,nonce:window.wooAiAssistant.nonce,pluginVersion:window.wooAiAssistant.version,isDebug:window.wooAiAssistant.debug||!1};try{const r=(0,i.H)(e);r.render((0,o.jsx)(t().StrictMode,{children:(0,o.jsx)(we,{widgetId:u,config:d})})),e._reactRoot=r}catch(h){e.innerHTML=`\n        <div style="\n          background: #f8d7da; \n          color: #721c24; \n          padding: 12px; \n          border-radius: 4px; \n          border: 1px solid #f5c6cb;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          font-size: 14px;\n        ">\n          <strong>Woo AI Assistant Error:</strong> Failed to initialize chat widget.\n          ${d.isDebug?`<br><small>${h.message}</small>`:""}\n        </div>\n      `}})};"complete"!==document.readyState&&"interactive"!==document.readyState||setTimeout(Se,100),document.addEventListener("DOMContentLoaded",Se),window.addEventListener("load",Se),void 0!==window.jQuery&&window.jQuery(document).ready(Se),window.WooAiAssistant={init:Se,reinit:()=>{document.querySelectorAll("[data-woo-ai-widget]").forEach(e=>{e._reactRoot&&(e._reactRoot.unmount(),e._reactRoot=null)}),Se()},isLoaded:()=>document.querySelectorAll('[data-woo-ai-widget] [data-widget-loaded="true"]').length>0,getInstances:()=>Array.from(document.querySelectorAll("[data-woo-ai-widget]")).filter(e=>e._reactRoot).map(e=>({id:e.id,container:e,root:e._reactRoot}))};var xe=window.WooAiAssistant}(),window.WooAiAssistant=s}();