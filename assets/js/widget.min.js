!function(){var e={338:function(e,t,r){"use strict";var s=r(795);t.H=s.createRoot,s.hydrateRoot},556:function(e,t,r){e.exports=r(694)()},694:function(e,t,r){"use strict";var s=r(925);function i(){}function n(){}n.resetWarningCache=i,e.exports=function(){function e(e,t,r,i,n,o){if(o!==s){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:i};return r.PropTypes=r,r}},795:function(e){"use strict";e.exports=window.ReactDOM},925:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function r(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};!function(){"use strict";r.r(s),r.d(s,{default:function(){return W}});var e=window.React,t=r.n(e),i=r(338),n=r(556),o=r.n(n),a=window.ReactJSXRuntime;const c=({message:e,showTimestamp:t=!0,showAvatar:r=!0})=>{const{id:s,content:i,type:n,timestamp:o}=e;return(0,a.jsxs)("div",{className:"message "+("user"===n?"user-message":"bot-message"),"data-message-id":s,role:"bot"===n?"log":void 0,"aria-label":"user"===n?"Your message":"Assistant message",children:["bot"===n&&r&&(0,a.jsx)("div",{className:"message-avatar","aria-hidden":"true",children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"currentColor"}),(0,a.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M9 9h.01M15 9h.01",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,a.jsxs)("div",{className:"message-content",children:[(0,a.jsx)("div",{className:"message-text",children:i}),t&&o&&(0,a.jsx)("time",{className:"message-timestamp",dateTime:o,title:new Date(o).toLocaleString(),children:(()=>{if(!o)return"";try{return new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){return""}})()})]})]})};l=c,c.propTypes={message:o().shape({id:o().oneOfType([o().string,o().number]).isRequired,content:o().string.isRequired,type:o().oneOf(["user","bot"]).isRequired,timestamp:o().string}).isRequired,showTimestamp:o().bool,showAvatar:o().bool},c.defaultProps={showTimestamp:!0,showAvatar:!0};var l,u=c;$RefreshReg$(l,"Message");const d=({showAvatar:e=!0,ariaLabel:t="AI assistant is typing",className:r=""})=>(0,a.jsxs)("div",{className:`message bot-message typing-indicator ${r}`,role:"status","aria-live":"polite","aria-label":t,children:[e&&(0,a.jsx)("div",{className:"message-avatar","aria-hidden":"true",children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",fill:"currentColor"}),(0,a.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),(0,a.jsx)("path",{d:"M9 9h.01M15 9h.01",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,a.jsxs)("div",{className:"message-content",children:[(0,a.jsxs)("div",{className:"typing-dots","aria-hidden":"true",children:[(0,a.jsx)("span",{className:"dot dot-1"}),(0,a.jsx)("span",{className:"dot dot-2"}),(0,a.jsx)("span",{className:"dot dot-3"})]}),(0,a.jsx)("span",{className:"sr-only",children:t})]})]});h=d,d.propTypes={showAvatar:o().bool,ariaLabel:o().string,className:o().string},d.defaultProps={showAvatar:!0,ariaLabel:"AI assistant is typing",className:""};var h,g=d;$RefreshReg$(h,"TypingIndicator");var p=$RefreshSig$();const m=({onSendMessage:t,isDisabled:r=!1,isTyping:s=!1,placeholder:i="Type your message...",maxLength:n=1e3,showCounterAt:o=800,autoFocus:c=!1,onFocus:l,onBlur:u})=>{p();const[d,h]=(0,e.useState)(""),[g,m]=(0,e.useState)(!1),f=(0,e.useRef)(null);(0,e.useEffect)(()=>{c&&f.current&&setTimeout(()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.focus()},100)},[c]);const y=(0,e.useCallback)(e=>{const t=e.target.value;t.length<=n&&h(t)},[n]),w=(0,e.useCallback)(e=>{e.preventDefault();const i=d.trim();!i||s||r||(t(i),h(""),setTimeout(()=>{var e;return null===(e=f.current)||void 0===e?void 0:e.focus()},50))},[d,s,r,t]),b=(0,e.useCallback)(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w(e))},[w]),v=(0,e.useCallback)(e=>{m(!0),l&&l(e)},[l]),x=(0,e.useCallback)(e=>{m(!1),u&&u(e)},[u]),A=d.trim()&&!s&&!r,R=d.length>=o,C=n-d.length;return(0,a.jsxs)("form",{className:"chat-input-form",onSubmit:w,role:"form","aria-label":"Message input form",children:[(0,a.jsxs)("div",{className:"input-container "+(g?"focused":""),children:[(0,a.jsx)("textarea",{ref:f,value:d,onChange:y,onKeyDown:b,onFocus:v,onBlur:x,placeholder:i,"aria-label":"Type your message","aria-describedby":R?"char-counter":void 0,className:"message-input",rows:"1",disabled:r,maxLength:n,style:{minHeight:"20px",maxHeight:"120px",resize:"none",overflow:"auto"}}),(0,a.jsxs)("button",{type:"submit",className:"send-button "+(A?"enabled":"disabled"),disabled:!A,"aria-label":"Send message"+(s?" (AI is typing)":""),title:s?"Please wait for AI response":d.trim()?"Send message (Enter)":"Enter a message to send",children:[(0,a.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M22 2L11 13M22 2L15 22L11 13M22 2L2 9L11 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,a.jsx)("span",{className:"sr-only",children:"Send"})]})]}),R&&(0,a.jsxs)("div",{id:"char-counter",className:"character-counter "+(C<50?"counter-critical":C<100?"counter-warning":"counter-normal"),role:"status","aria-live":"polite",children:[d.length,"/",n,C<50&&(0,a.jsxs)("span",{className:"sr-only",children:[C," characters remaining"]})]}),g&&!r&&(0,a.jsx)("div",{className:"input-helper",role:"status",children:(0,a.jsxs)("span",{className:"keyboard-hint",children:["Press ",(0,a.jsx)("kbd",{children:"Enter"})," to send, ",(0,a.jsx)("kbd",{children:"Shift+Enter"})," for new line"]})})]})};p(m,"aFnETf/uRYwqzTFVQN6ZAdvZHic="),f=m,m.propTypes={onSendMessage:o().func.isRequired,isDisabled:o().bool,isTyping:o().bool,placeholder:o().string,maxLength:o().number,showCounterAt:o().number,autoFocus:o().bool,onFocus:o().func,onBlur:o().func},m.defaultProps={isDisabled:!1,isTyping:!1,placeholder:"Type your message...",maxLength:1e3,showCounterAt:800,autoFocus:!1,onFocus:null,onBlur:null};var f,y=m;$RefreshReg$(f,"MessageInput");var w=$RefreshSig$();const b=({isVisible:t,onToggleVisibility:r,onClose:s,conversation:i,isTyping:n,connectionStatus:o,onSendMessage:c,onClearConversation:l,onReconnect:d,config:h,userContext:p,pageContext:m,error:f,onDismissError:b})=>{var v,x,A,R;w();const[C,k]=(0,e.useState)(!1),[T,E]=(0,e.useState)(!0),[S,j]=(0,e.useState)(!0),I=(0,e.useRef)(null),N=(0,e.useRef)(null),O=(0,e.useCallback)(()=>{S&&I.current&&I.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[S]),q=(0,e.useCallback)(()=>{if(N.current){const{scrollTop:e,scrollHeight:t,clientHeight:r}=N.current;j(t-e-r<50)}},[]);(0,e.useEffect)(()=>{t&&O()},[t,i,O]);const L=(0,e.useCallback)(e=>{c(e),E(!1),j(!0),setTimeout(O,100)},[c,O]),M=(0,e.useCallback)(()=>{k(!0),setTimeout(()=>{r(),k(!1)},200)},[r]);(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&t&&M()};return t&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,M]);const D=(()=>{switch(o){case"connected":return{text:"Online",className:"status-connected"};case"connecting":return{text:"Connecting...",className:"status-connecting"};case"disconnected":return{text:"Disconnected",className:"status-disconnected"};case"error":return{text:"Connection Error",className:"status-error"};default:return{text:"Unknown",className:"status-unknown"}}})();return(0,a.jsxs)("div",{className:`chat-widget ${t?"visible":"minimized"} ${C?"minimizing":""}`,role:"dialog","aria-label":"AI Assistant Chat","aria-expanded":t,"data-connection-status":o,children:[!t&&(0,a.jsxs)("button",{className:"chat-toggle-button",onClick:r,"aria-label":"Open AI Assistant Chat",title:"Chat with AI Assistant",children:[(0,a.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V16C2 17.1 2.9 18 4 18H6L10 22L14 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z",fill:"currentColor"})}),(0,a.jsx)("span",{className:"sr-only",children:"Open Chat"})]}),t&&(0,a.jsxs)("div",{className:"chat-window",children:[(0,a.jsxs)("div",{className:"chat-header",children:[(0,a.jsxs)("div",{className:"chat-title",children:[(0,a.jsx)("h3",{children:"AI Assistant"}),(0,a.jsxs)("div",{className:`connection-status ${D.className}`,children:[(0,a.jsx)("span",{className:"status-indicator","aria-hidden":"true"}),(0,a.jsx)("span",{className:"status-text",children:D.text})]})]}),(0,a.jsxs)("div",{className:"chat-controls",children:[(0,a.jsx)("button",{className:"control-button minimize-button",onClick:M,"aria-label":"Minimize chat",title:"Minimize",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M4 8H12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,a.jsx)("button",{className:"control-button close-button",onClick:s,"aria-label":"Close chat",title:"Close",children:(0,a.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none","aria-hidden":"true",children:(0,a.jsx)("path",{d:"M12 4L4 12M4 4L12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]}),f&&(0,a.jsxs)("div",{className:"chat-error",role:"alert","aria-live":"polite",children:[(0,a.jsxs)("div",{className:"error-content",children:[(0,a.jsx)("span",{className:"error-message",children:f.message}),(0,a.jsx)("button",{className:"error-dismiss",onClick:b,"aria-label":"Dismiss error",children:"×"})]}),"error"===o&&d&&(0,a.jsx)("button",{className:"retry-button",onClick:d,children:"Try Again"})]}),(0,a.jsxs)("div",{className:"chat-messages",ref:N,onScroll:q,role:"log","aria-live":"polite","aria-label":"Chat messages",children:[T&&0===i.length&&(0,a.jsx)(u,{message:{id:"welcome",content:(()=>{if(h.welcomeMessage)return h.welcomeMessage;switch(null==m?void 0:m.type){case"product":return"Hi! I can help you with questions about this product, shipping, or anything else.";case"shop":return"Hi! I'm here to help you find the perfect products. What are you looking for?";case"cart":return"Hi! Need help with your cart or have questions before checkout?";default:return"Hi! I'm your AI assistant. How can I help you today?"}})(),type:"bot",timestamp:(new Date).toISOString()},showTimestamp:!1,showAvatar:!0}),i.map((e,t)=>(0,a.jsx)(u,{message:e,showTimestamp:!1!==(null==h?void 0:h.showTimestamps),showAvatar:"bot"===e.type},e.id||`msg-${t}`)),n&&(0,a.jsx)(g,{showAvatar:!0,ariaLabel:(null==h||null===(v=h.strings)||void 0===v?void 0:v.typing)||"AI assistant is typing"}),(0,a.jsx)("div",{ref:I,"aria-hidden":"true"})]}),(0,a.jsx)(y,{onSendMessage:L,isDisabled:"error"===o||"disconnected"===o,isTyping:n,placeholder:(null==h||null===(x=h.strings)||void 0===x?void 0:x.inputPlaceholder)||"Type your message...",maxLength:(null==h||null===(A=h.limits)||void 0===A?void 0:A.maxMessageLength)||1e3,showCounterAt:(null==h||null===(R=h.limits)||void 0===R?void 0:R.showCounterAt)||800,autoFocus:t}),i.length>0&&(0,a.jsx)("div",{className:"chat-footer",children:(0,a.jsx)("button",{className:"clear-chat-button",onClick:l,title:"Clear conversation",children:"Clear Chat"})})]})]})};w(b,"FFLhLFQzHCsRq9FCJuNRGqJ2J1E="),v=b,b.propTypes={isVisible:o().bool.isRequired,onToggleVisibility:o().func.isRequired,onClose:o().func.isRequired,conversation:o().arrayOf(o().shape({id:o().oneOfType([o().string,o().number]),type:o().oneOf(["user","bot"]).isRequired,content:o().string.isRequired,timestamp:o().string})),isTyping:o().bool,connectionStatus:o().oneOf(["connected","connecting","disconnected","error"]),onSendMessage:o().func.isRequired,onClearConversation:o().func.isRequired,onReconnect:o().func,config:o().shape({welcomeMessage:o().string,language:o().string,theme:o().oneOf(["light","dark","auto"]),position:o().oneOf(["bottom-left","bottom-right","top-left","top-right"]),showTimestamps:o().bool,strings:o().shape({inputPlaceholder:o().string,typing:o().string,clearChat:o().string,minimize:o().string,close:o().string}),limits:o().shape({maxMessageLength:o().number,showCounterAt:o().number,maxConversationLength:o().number})}).isRequired,userContext:o().shape({id:o().number,email:o().string}).isRequired,pageContext:o().shape({type:o().string,id:o().number,url:o().string}).isRequired,error:o().shape({message:o().string.isRequired,critical:o().bool}),onDismissError:o().func.isRequired},b.defaultProps={conversation:[],isTyping:!1,connectionStatus:"connecting",error:null,onReconnect:null};var v,x=b;$RefreshReg$(v,"ChatWindow");class A extends t().Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){this.setState({error:e,errorInfo:t}),this.props.onError&&this.props.onError({error:e,errorInfo:t,timestamp:(new Date).toISOString()})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,a.jsx)("div",{className:"error-boundary-fallback",role:"alert","aria-live":"polite",children:(0,a.jsxs)("div",{className:"error-content",children:[(0,a.jsx)("h4",{children:"Something went wrong"}),(0,a.jsx)("p",{children:"The chat widget encountered an error. Please refresh the page to try again."}),(0,a.jsxs)("div",{className:"error-actions",children:[(0,a.jsx)("button",{className:"retry-button",onClick:()=>window.location.reload(),type:"button",children:"Refresh Page"}),this.props.onRetry&&(0,a.jsx)("button",{className:"retry-button",onClick:()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onRetry()},type:"button",children:"Try Again"})]}),!1]})}):this.props.children}}A.propTypes={children:o().node.isRequired,onError:o().func,onRetry:o().func,fallback:o().node},A.defaultProps={onError:null,onRetry:null,fallback:null};var R=A,C=$RefreshSig$(),k=$RefreshSig$();function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(t){S(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function S(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const j={namespace:"woo-ai-assistant/v1",endpoints:{chat:"/chat",action:"/action",rating:"/rating",config:"/config"},retryConfig:{maxRetries:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2},timeouts:{default:3e4,streaming:6e4,config:1e4},rateLimits:{requests:60,windowMs:6e4}},I={NETWORK:"network_error",TIMEOUT:"timeout_error",RATE_LIMIT:"rate_limit_error",AUTHENTICATION:"auth_error",VALIDATION:"validation_error",SERVER:"server_error",STREAMING:"streaming_error",UNKNOWN:"unknown_error"},N=(0,e.createContext)(null),O=()=>{C();const t=(0,e.useContext)(N);if(!t)throw new Error("useApi must be used within an ApiProvider");return t};C(O,"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=");class q{constructor({baseUrl:e,nonce:t,userId:r,pageContext:s,onError:i}){this.baseUrl=this.normalizeBaseUrl(e),this.nonce=t,this.userId=r,this.pageContext=s||{},this.onError=i||(()=>{}),this.requestQueue=[],this.activeRequests=new Set,this.retryAttempts=new Map,this.circuitBreakerState={isOpen:!1,failures:0,lastFailureTime:null,threshold:5,timeout:3e4},this.debugLog("ApiService initialized",{baseUrl:this.baseUrl,userId:this.userId,pageContext:this.pageContext})}normalizeBaseUrl(e){return e?e.replace(/\/$/,""):window.location.origin}buildApiUrl(e){return`${`${this.baseUrl}/wp-json`}/${`${j.namespace}${e}`}`}createHeaders(e={}){return E({"Content-Type":"application/json","X-WP-Nonce":this.nonce,"X-Requested-With":"XMLHttpRequest"},e)}isCircuitBreakerOpen(){const{isOpen:e,lastFailureTime:t,timeout:r}=this.circuitBreakerState;return!!e&&(!(Date.now()-t>r)||(this.circuitBreakerState.isOpen=!1,this.circuitBreakerState.failures=0,this.debugLog("Circuit breaker closed after timeout"),!1))}recordCircuitBreakerFailure(){this.circuitBreakerState.failures+=1,this.circuitBreakerState.lastFailureTime=Date.now(),this.circuitBreakerState.failures>=this.circuitBreakerState.threshold&&(this.circuitBreakerState.isOpen=!0,this.debugLog("Circuit breaker opened due to failures",{failures:this.circuitBreakerState.failures}))}resetCircuitBreaker(){this.circuitBreakerState.failures>0&&(this.circuitBreakerState.failures=0,this.circuitBreakerState.isOpen=!1,this.debugLog("Circuit breaker reset after successful request"))}checkRateLimit(){const e=Date.now(),{requests:t,windowMs:r}=j.rateLimits;return this.requestQueue=this.requestQueue.filter(t=>e-t<r),this.requestQueue.length>=t?(this.debugLog("Rate limit exceeded",{requests:this.requestQueue.length,limit:t}),!1):(this.requestQueue.push(e),!0)}calculateRetryDelay(e){const{baseDelay:t,maxDelay:r,backoffFactor:s}=j.retryConfig;return Math.min(t*Math.pow(s,e),r)+1e3*Math.random()}delay(e){return new Promise(t=>setTimeout(t,e))}async makeRequest(e,t={}){const{method:r="GET",body:s=null,headers:i={},timeout:n=j.timeouts.default,skipRetry:o=!1}=t,a=`${r}-${e}-${Date.now()}`;if(this.debugLog("Making API request",{requestId:a,endpoint:e,method:r,timeout:n}),this.isCircuitBreakerOpen()){throw this.createApiError(I.SERVER,"Service temporarily unavailable",503,{circuitBreakerOpen:!0})}if(!this.checkRateLimit()){throw this.createApiError(I.RATE_LIMIT,"Too many requests. Please try again later.",429)}const c=this.buildApiUrl(e),l=this.createHeaders(i),u=new AbortController,d=setTimeout(()=>{u.abort()},n),h={method:r,headers:l,signal:u.signal};!s||"POST"!==r&&"PUT"!==r&&"PATCH"!==r||(h.body=JSON.stringify(s)),this.activeRequests.add(a);try{const e=await fetch(c,h);clearTimeout(d),e.ok||await this.handleErrorResponse(e);const t=await e.json();return this.resetCircuitBreaker(),this.debugLog("API request successful",{requestId:a,status:e.status}),t}catch(g){let s;if(clearTimeout(d),this.recordCircuitBreakerFailure(),s="AbortError"===g.name?this.createApiError(I.TIMEOUT,"Request timed out. Please try again.",408,{timeout:n}):g instanceof TypeError&&g.message.includes("fetch")?this.createApiError(I.NETWORK,"Network error. Please check your connection.",0,{originalError:g.message}):g.isApiError?g:this.createApiError(I.UNKNOWN,"An unexpected error occurred.",0,{originalError:g.message}),this.debugLog("API request failed",{requestId:a,error:s}),!o){const i=`${r}-${e}`,n=this.retryAttempts.get(i)||0;if(n<j.retryConfig.maxRetries&&this.shouldRetry(s)){this.retryAttempts.set(i,n+1);const r=this.calculateRetryDelay(n);return this.debugLog("Retrying request",{requestId:a,attempt:n+1,delay:r}),await this.delay(r),this.makeRequest(e,E(E({},t),{},{skipRetry:!1}))}this.retryAttempts.delete(i)}throw s}finally{this.activeRequests.delete(a)}}async handleErrorResponse(e){let t,r;try{t=await e.json()}catch(s){t={message:`HTTP ${e.status}: ${e.statusText}`,code:"http_error"}}switch(e.status){case 400:r=I.VALIDATION;break;case 401:case 403:r=I.AUTHENTICATION;break;case 429:r=I.RATE_LIMIT;break;case 500:case 502:case 503:case 504:r=I.SERVER;break;default:r=I.UNKNOWN}throw this.createApiError(r,t.message||"Request failed",e.status,t)}shouldRetry(e){return e.type!==I.AUTHENTICATION&&e.type!==I.VALIDATION&&(e.type!==I.RATE_LIMIT&&[I.NETWORK,I.TIMEOUT,I.SERVER,I.UNKNOWN].includes(e.type))}createApiError(e,t,r=0,s={}){const i=new Error(t);return i.isApiError=!0,i.type=e,i.status=r,i.details=s,i.timestamp=(new Date).toISOString(),i}async sendMessage(e,t=null,r={}){if(!e||"string"!=typeof e||!e.trim())throw this.createApiError(I.VALIDATION,"Message is required and must be a non-empty string");const s={message:e.trim(),conversation_id:t,user_context:E(E(E({},this.pageContext),r),{},{timestamp:(new Date).toISOString()}),nonce:this.nonce};try{const e=await this.makeRequest(j.endpoints.chat,{method:"POST",body:s,timeout:j.timeouts.default});if(!e.success||!e.data)throw this.createApiError(I.SERVER,"Invalid response format from server");return{conversationId:e.data.conversation_id,response:e.data.response,timestamp:e.data.timestamp,confidence:e.data.confidence||0,sources:e.data.sources||[],metadata:e.data.metadata||{}}}catch(i){throw this.onError({message:i.message,type:i.type||I.UNKNOWN,critical:i.type===I.AUTHENTICATION,details:i.details}),i}}async sendStreamingMessage(e,t=null,r=null,s={}){this.debugLog("Streaming not yet supported, falling back to regular message");const i=await this.sendMessage(e,t,s);if(r&&i.response){const e=i.response.split(" "),t=Math.max(1,Math.floor(e.length/8));for(let s=0;s<e.length;s+=t){r({chunk:e.slice(s,s+t).join(" "),isComplete:s+t>=e.length,progress:Math.min(1,(s+t)/e.length)}),await this.delay(100)}}return i}async executeAction(e,t,r){if(!e||!t||!r)throw this.createApiError(I.VALIDATION,"Action type, data, and conversation ID are required");const s={action_type:e,action_data:t,conversation_id:r,nonce:this.nonce};try{const e=await this.makeRequest(j.endpoints.action,{method:"POST",body:s});return e.data||e}catch(i){throw this.onError({message:`Action failed: ${i.message}`,type:i.type||I.UNKNOWN,critical:!1,details:E({actionType:e},i.details)}),i}}async submitRating(e,t,r=""){if(!e||!t||t<1||t>5)throw this.createApiError(I.VALIDATION,"Valid conversation ID and rating (1-5) are required");const s={conversation_id:e,rating:Math.floor(t),feedback:r.trim(),nonce:this.nonce};try{const e=await this.makeRequest(j.endpoints.rating,{method:"POST",body:s});return e.data||e}catch(i){throw this.onError({message:`Rating submission failed: ${i.message}`,type:i.type||I.UNKNOWN,critical:!1}),i}}async getConfig(e={}){try{const t=new URLSearchParams;Object.keys(e).length>0&&t.set("page_context",JSON.stringify(e));const r=j.endpoints.config+(t.toString()?`?${t.toString()}`:""),s=await this.makeRequest(r,{method:"GET",timeout:j.timeouts.config});return s.data||s}catch(t){return this.debugLog("Failed to load config, using defaults",t),{theme:"light",language:"en",welcomeMessage:"Hi! How can I help you today?",features:{streaming:!1,actions:!0,ratings:!0}}}}async testConnection(){try{return await this.getConfig(),!0}catch(e){return this.debugLog("Connection test failed",e),!1}}cancelAllRequests(){this.debugLog("Cancelling all active requests",{activeCount:this.activeRequests.size}),this.activeRequests.clear(),this.requestQueue=[],this.retryAttempts.clear()}debugLog(e,t={}){var r;null===(r=window.wooAiAssistant)||void 0===r||r.debug}}const L=({children:t,baseUrl:r,nonce:s,userId:i,pageContext:n,onError:o})=>{k();const c=(0,e.useMemo)(()=>new q({baseUrl:r,nonce:s,userId:i,pageContext:n,onError:o}),[r,s,i,n,o]);return(0,a.jsx)(N.Provider,{value:c,children:t})};k(L,"6vt49p7o+R35/YjvJFhrSLrB75U="),M=L,L.propTypes={children:o().node.isRequired,baseUrl:o().string.isRequired,nonce:o().string.isRequired,userId:o().number.isRequired,pageContext:o().shape({type:o().string,id:o().number,url:o().string}),onError:o().func.isRequired},L.defaultProps={pageContext:{}};var M;$RefreshReg$(M,"ApiProvider");var D=$RefreshSig$();const P=({apiEndpoint:t,nonce:r,userId:s,pageContext:i,onError:n})=>{D();const[o,a]=(0,e.useState)([]),[c,l]=(0,e.useState)(!1),[u,d]=(0,e.useState)("connecting"),[h,g]=(0,e.useState)(null),p=O();(0,e.useEffect)(()=>{p&&(async()=>{try{if(d("connecting"),!await p.testConnection())throw new Error("API connectivity test failed");d("connected"),g(`conv_${Date.now()}_${s}`)}catch(e){d("error"),n&&n({message:"Failed to connect to chat service",type:"connection_error",critical:!1})}})()},[p,s,n]);const m=(0,e.useCallback)(async e=>{if(!e.trim()||!h||!p)return;const t={id:`msg_${Date.now()}`,content:e.trim(),type:"user",timestamp:(new Date).toISOString()};a(e=>[...e,t]),l(!0);try{const t=await p.sendMessage(e,h,i);t.conversationId&&t.conversationId!==h&&g(t.conversationId);const r={id:`msg_${Date.now()+1}`,content:t.response,type:"bot",timestamp:t.timestamp||(new Date).toISOString(),confidence:t.confidence,sources:t.sources,metadata:t.metadata};a(e=>[...e,r]),l(!1)}catch(r){l(!1),"auth_error"!==r.type&&"server_error"!==r.type||d("error")}},[h,p,i]),f=(0,e.useCallback)(async(e,t)=>{if(!e.trim()||!h||!p)return;const r={id:`msg_${Date.now()}`,content:e.trim(),type:"user",timestamp:(new Date).toISOString()};a(e=>[...e,r]),l(!0);try{const r=await p.sendStreamingMessage(e,h,t,i);r.conversationId&&r.conversationId!==h&&g(r.conversationId);const s={id:`msg_${Date.now()+1}`,content:r.response,type:"bot",timestamp:r.timestamp||(new Date).toISOString(),confidence:r.confidence,sources:r.sources,metadata:r.metadata};return a(e=>[...e,s]),l(!1),r}catch(s){throw l(!1),"auth_error"!==s.type&&"server_error"!==s.type||d("error"),s}},[h,p,i]),y=(0,e.useCallback)(async(e,t)=>{if(!h||!p)throw new Error("Chat not initialized");try{return await p.executeAction(e,t,h)}catch(r){throw r}},[h,p]),w=(0,e.useCallback)(async(e,t="")=>{if(!h||!p)throw new Error("Chat not initialized");try{return await p.submitRating(h,e,t)}catch(r){throw r}},[h,p]),b=(0,e.useCallback)(()=>{a([]),g(`conv_${Date.now()}_${s}`)},[s]),v=(0,e.useCallback)(async()=>{if(p){d("connecting");try{if(!await p.testConnection())throw new Error("Reconnection failed");d("connected")}catch(e){d("error"),n&&n({message:"Failed to reconnect",type:"reconnection_error",critical:!1})}}},[p,n]);return(0,e.useEffect)(()=>()=>{p&&p.cancelAllRequests()},[p]),{conversation:o,isTyping:c,connectionStatus:u,conversationId:h,sendMessage:m,sendStreamingMessage:f,executeAction:y,submitRating:w,clearConversation:b,reconnect:v}};D(P,"AL2B/p3CPbyudSPJ8HaBQzT/KpI=",!1,function(){return[O]});var $=$RefreshSig$();const _=({isVisible:t,onToggleVisibility:r,onEscape:s})=>{$(),(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&t&&s&&(e.preventDefault(),s()),(e.ctrlKey||e.metaKey)&&e.shiftKey&&"c"===e.key.toLowerCase()&&r&&(e.preventDefault(),r()),"Enter"===e.key&&e.target.matches("[data-chat-action]")&&(e.preventDefault(),e.target.click())};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[t,r,s]),(0,e.useEffect)(()=>{if(t){const e=document.querySelector('.woo-ai-assistant-app[data-visible="true"]');if(e){const t=e.querySelector('button, input, textarea, select, [tabindex]:not([tabindex="-1"])');t&&t.focus()}}},[t])};$(_,"3ubReDTFssvu4DHeldAg55cW/CI=");var U=$RefreshSig$();const B=({widgetId:t,config:r})=>{U();const[s,i]=(0,e.useState)(!r.minimized),[n,o]=(0,e.useState)(!1),[c,l]=(0,e.useState)(null),{conversation:u,isTyping:d,connectionStatus:h,sendMessage:g,clearConversation:p,reconnect:m}=P({apiEndpoint:r.apiEndpoint,nonce:r.nonce,userId:r.userId,pageContext:{type:r.pageType,id:r.pageId,url:r.pageUrl},onError:l});_({isVisible:s,onToggleVisibility:()=>i(!s),onEscape:()=>i(!1)});const f=(0,e.useCallback)(()=>{i(e=>!e),!s&&c&&l(null)},[s,c]),y=(0,e.useCallback)(()=>{i(!1)},[]);return(0,e.useEffect)(()=>{if(r.autoOpen&&!s){const e=setTimeout(()=>{i(!0)},2e3);return()=>clearTimeout(e)}},[r.autoOpen,s]),(0,e.useEffect)(()=>{o(!0);const e=document.getElementById(t);return e&&e.setAttribute("data-widget-loaded","true"),()=>{e&&e.removeAttribute("data-widget-loaded")}},[t]),(0,e.useEffect)(()=>{r.isDebug},[t,r,s,h]),c&&c.critical?(0,a.jsx)("div",{className:"woo-ai-widget-error",role:"alert","aria-live":"polite",children:(0,a.jsxs)("div",{className:"error-content",children:[(0,a.jsx)("h4",{children:"Chat Unavailable"}),(0,a.jsx)("p",{children:"The chat service is temporarily unavailable. Please try again later or contact support."}),r.isDebug&&(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{children:"Error Details"}),(0,a.jsx)("pre",{children:c.message})]})]})}):(0,a.jsx)(R,{onError:e=>{r.isDebug&&l({message:e.error.message,stack:e.errorInfo.componentStack,critical:!1})},children:(0,a.jsx)(L,{baseUrl:r.apiEndpoint,nonce:r.nonce,debug:r.isDebug,children:(0,a.jsx)("div",{className:`woo-ai-assistant-app ${r.theme}`,"data-widget-id":t,"data-position":r.position,"data-visible":s,"data-loaded":n,style:{"--widget-primary-color":r.primaryColor||"#007cba","--widget-secondary-color":r.secondaryColor||"#f0f0f1","--widget-text-color":r.textColor||"#1e1e1e","--widget-border-radius":r.borderRadius||"8px"},children:(0,a.jsx)(x,{isVisible:s,onToggleVisibility:f,onClose:y,conversation:u,isTyping:d,connectionStatus:h,onSendMessage:g,onClearConversation:p,onReconnect:m,config:{welcomeMessage:r.welcomeMessage,language:r.language,theme:r.theme,position:r.position,strings:window.wooAiAssistant.strings||{},limits:window.wooAiAssistant.limits||{}},userContext:{id:r.userId,email:r.userEmail},pageContext:{type:r.pageType,id:r.pageId,url:r.pageUrl},error:c,onDismissError:()=>l(null)})})})})};U(B,"/OhsGinlyG7kxVcokcsYvWU+EyM=",!1,function(){return[P,_]}),H=B,B.propTypes={widgetId:o().string.isRequired,config:o().shape({position:o().oneOf(["bottom-left","bottom-right","top-left","top-right"]),autoOpen:o().bool,minimized:o().bool,userId:o().number,userEmail:o().string,pageType:o().string,pageId:o().number,pageUrl:o().string,welcomeMessage:o().string,theme:o().oneOf(["light","dark","auto"]),language:o().string,primaryColor:o().string,secondaryColor:o().string,textColor:o().string,borderRadius:o().string,apiEndpoint:o().string.isRequired,nonce:o().string.isRequired,isDebug:o().bool,pluginVersion:o().string}).isRequired},B.defaultProps={config:{position:"bottom-right",autoOpen:!1,minimized:!0,theme:"light",language:"en",isDebug:!1}};var H,V=B;$RefreshReg$(H,"App");const F=()=>{if(void 0===window.wooAiAssistant)return;let e=Array.from(document.querySelectorAll("[data-woo-ai-widget]"));if(0===e.length){const t=document.createElement("div");t.id="woo-ai-assistant-widget",t.setAttribute("data-woo-ai-widget","true"),document.body.appendChild(t),e=[t]}e.forEach((e,r)=>{var s,n,o,c,l;const u=`woo-ai-widget-${r}`;e.id=u;const d={position:e.getAttribute("data-position")||"bottom-right",autoOpen:"true"===e.getAttribute("data-auto-open"),minimized:"false"!==e.getAttribute("data-minimized"),userId:(null===(s=window.wooAiAssistant.currentUser)||void 0===s?void 0:s.id)||0,userEmail:(null===(n=window.wooAiAssistant.currentUser)||void 0===n?void 0:n.email)||"",pageType:(null===(o=window.wooAiAssistant.currentPage)||void 0===o?void 0:o.type)||"unknown",pageId:(null===(c=window.wooAiAssistant.currentPage)||void 0===c?void 0:c.id)||0,pageUrl:(null===(l=window.wooAiAssistant.currentPage)||void 0===l?void 0:l.url)||window.location.href,welcomeMessage:e.getAttribute("data-welcome-message")||"",theme:e.getAttribute("data-theme")||"light",language:e.getAttribute("data-language")||"en",apiEndpoint:window.wooAiAssistant.apiUrl,nonce:window.wooAiAssistant.nonce,pluginVersion:window.wooAiAssistant.version,isDebug:window.wooAiAssistant.debug||!1};try{const r=(0,i.H)(e);r.render((0,a.jsx)(t().StrictMode,{children:(0,a.jsx)(V,{widgetId:u,config:d})})),e._reactRoot=r}catch(h){e.innerHTML=`\n        <div style="\n          background: #f8d7da; \n          color: #721c24; \n          padding: 12px; \n          border-radius: 4px; \n          border: 1px solid #f5c6cb;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          font-size: 14px;\n        ">\n          <strong>Woo AI Assistant Error:</strong> Failed to initialize chat widget.\n          ${d.isDebug?`<br><small>${h.message}</small>`:""}\n        </div>\n      `}})};"complete"!==document.readyState&&"interactive"!==document.readyState||setTimeout(F,100),document.addEventListener("DOMContentLoaded",F),window.addEventListener("load",F),void 0!==window.jQuery&&window.jQuery(document).ready(F),window.WooAiAssistant={init:F,reinit:()=>{document.querySelectorAll("[data-woo-ai-widget]").forEach(e=>{e._reactRoot&&(e._reactRoot.unmount(),e._reactRoot=null)}),F()},isLoaded:()=>document.querySelectorAll('[data-woo-ai-widget] [data-widget-loaded="true"]').length>0,getInstances:()=>Array.from(document.querySelectorAll("[data-woo-ai-widget]")).filter(e=>e._reactRoot).map(e=>({id:e.id,container:e,root:e._reactRoot}))};var W=window.WooAiAssistant}(),window.WooAiAssistant=s}();